# Руководство по подготовке датасета для распознавания 5-значных капч

Этот документ содержит подробные рекомендации по подготовке качественного датасета для обучения нейросети, распознающей 5-значные цифровые капчи.

## 1. Общие рекомендации

### 1.1. Размер датасета

Для достижения высокой точности рекомендуется использовать следующие объемы данных:

- **Минимальный размер**: 10 000 изображений
- **Оптимальный размер**: 20 000 - 50 000 изображений
- **Распределение**: 80% обучающая выборка, 10% валидационная, 10% тестовая

### 1.2. Баланс классов

Важно обеспечить равномерное распределение цифр (0-9) в датасете:

- Каждая цифра должна встречаться примерно с одинаковой частотой
- Проверяйте распределение цифр по позициям (некоторые цифры могут чаще встречаться на определенных позициях)

## 2. Генерация синтетического датасета

### 2.1. Параметры изображений

- **Размер**: 100x40 пикселей (согласно требованиям проекта)
- **Цвет фона**: Базовый #759da3 с вариациями
- **Цвет цифр**: Базовый #1a2432 с вариациями
- **Формат**: PNG (без потери качества)

### 2.2. Вариации и искажения

Для повышения устойчивости модели рекомендуется добавлять следующие вариации:

#### 2.2.1. Вариации цвета

- Случайные отклонения от базового цвета фона (±20 единиц по каждому каналу RGB)
- Случайные отклонения от базового цвета цифр (±20 единиц по каждому каналу RGB)
- Различные уровни контраста между фоном и цифрами

#### 2.2.2. Геометрические искажения

- Небольшие повороты (±5 градусов)
- Небольшие искажения перспективы
- Различные размеры шрифта (в пределах 24-28 пикселей)
- Случайные смещения цифр по вертикали и горизонтали

#### 2.2.3. Шумы и артефакты

- Точки и линии случайного цвета
- Размытие по Гауссу (с малым радиусом)
- Случайный шум (salt-and-pepper, gaussian)
- Имитация JPEG-артефактов

### 2.3. Использование различных шрифтов

Для повышения разнообразия рекомендуется использовать различные шрифты:

- Моноширинные шрифты (Courier, Consolas)
- Шрифты с засечками (Times New Roman, Georgia)
- Шрифты без засечек (Arial, Verdana)

## 3. Использование реальных капч

Если у вас есть доступ к реальным капчам, рекомендуется:

### 3.1. Сбор и разметка

- Собрать набор реальных капч с известными ответами
- Вручную разметить изображения, если ответы неизвестны
- Создать файл с метками в формате `имя_файла.png 12345`

### 3.2. Аугментация реальных данных

- Применить те же техники аугментации, что и для синтетических данных
- Создать дополнительные примеры на основе реальных изображений

## 4. Предобработка изображений

### 4.1. Нормализация

- Изменение размера до 100x40 пикселей
- Преобразование в оттенки серого (опционально, можно сравнить с RGB)
- Нормализация значений пикселей в диапазон [0, 1]

### 4.2. Аугментации при обучении

- Случайные изменения яркости (±20%)
- Случайные изменения контраста (±20%)
- Добавление случайного шума (5%)

## 5. Проверка качества датасета

### 5.1. Визуальная проверка

- Просмотрите случайную выборку изображений
- Убедитесь, что цифры хорошо различимы человеком
- Проверьте соответствие меток и изображений

### 5.2. Статистический анализ

- Проверьте распределение цифр по позициям
- Убедитесь в отсутствии дубликатов
- Проанализируйте гистограммы яркости изображений

## 6. Запуск генерации датасета

Для генерации датасета с помощью предоставленного скрипта выполните команду:

```bash
python src/data_generator.py --num_samples 20000 --output_dir dataset
```

Дополнительные параметры:

- `--train_ratio 0.8` - доля обучающей выборки
- `--val_ratio 0.1` - доля валидационной выборки
- `--test_ratio 0.1` - доля тестовой выборки

## 7. Советы по улучшению датасета

### 7.1. Итеративное улучшение

- Обучите модель на начальном датасете
- Проанализируйте ошибки распознавания
- Добавьте больше примеров, похожих на те, где модель ошибается
- Повторите обучение и оценку

### 7.2. Сложные случаи

- Добавьте примеры с перекрывающимися цифрами
- Добавьте примеры с сильными искажениями
- Добавьте примеры с низким контрастом

### 7.3. Балансировка сложности

- 70% примеров - стандартной сложности
- 20% примеров - повышенной сложности
- 10% примеров - высокой сложности

Следуя этим рекомендациям, вы сможете создать качественный датасет, который позволит обучить нейросеть с высокой точностью распознавания 5-значных цифровых капч.
